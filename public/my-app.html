<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/polymerfire/polymerfire.html">
<link rel="import" href="bower_components/polymerfire/firebase-app.html">
<link rel="import" href="bower_components/app-route/app-location.html">
<link rel="import" href="bower_components/app-route/app-route.html">
<link rel="import" href="bower_components/iron-pages/iron-pages.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="my-login.html">

<link rel="import" href="shared-styles.html">

<dom-module id="my-app">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }
    </style>

    <firebase-app
      id="firebase"
      auth-domain="spotify-party-da303.firebaseapp.com"
      database-url="https://spotify-party-da303.firebaseio.com/"
      api-key="AIzaSyBJxf-hJa7RQVBPYkdjt27yBcDj0b1tG8o">
    </firebase-app>

    <app-location route="{{route}}"></app-location>
    <app-route
        route="{{route}}"
        pattern="/:page"
        data="{{routeData}}"
        tail="{{subroute}}"></app-route>

    <iron-pages
        selected="[[page]]"
        attr-for-selected="name"
        fallback-selection="404"
        role="main">
      <login-page name="login-page"></login-page>
      <join-party-page name="join-party-page"></join-party-page>
      <queue-page name="queue-page"></queue-page>
      <party-page name="party-page"></party-page>
      <404-page name="404"></404-page>
    </iron-pages>


    <my-login></my-login>
    
  </template>
  <script>
    Polymer({

      is: 'my-app',

      properties: {
        page: {
          type: String,
          reflectToAttribute: true,
          observer: '_pageChanged',
        },
      },

      observers: [
        '_routePageChanged(routeData.page)',
      ],

      _routePageChanged: function(page) {
        this.page = page || 'login-page';
      },

      _pageChanged: function(page) {
        // Load page import on demand. Show 404 page if fails
        var resolvedPageUrl = this.resolveUrl(page + '-page' + '.html');
        this.importHref(resolvedPageUrl, null, this._showPage404, true);
      },

      _showPage404: function() {
        this.page = '404';
      },

    });
  </script>
</dom-module>
