<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">

<link rel="import" href="shared-styles.html">

<dom-module id="my-queue">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        margin: 20px;
      }

      .trackContainer {
        margin-bottom: 50px;
      }
    </style>

    <template
        is="dom-repeat"
        id="queueRepeat"
        items="[[tracks]]"
        as="track"
        itemsIndexAs="trackIndex"
        initial-count="5"
        target-framerate="60">

      <div class="trackContainer">
        <paper-checkbox
            checked="[[_computeChecked(track.votes)]]"
            on-change="_trackChecked"></paper-checkbox>
        [[_computeVoteCount(track.votes)]]
        [[track.name]] • [[track.artist]] • [[track.album]]
      </div>
    </template>

  </template>

  <script>
    class MyQueue extends Polymer.Element {

      static get is() { return 'my-queue'; }

      static get properties() {
        return {
          tracks: Array
        };
      }

      ready() {
        super.ready();
        this.dispatchEvent(new CustomEvent('load-status', { detail: 'load-end', bubbles: true, composed: true }));
      }

      _computeChecked(votes) {
        return votes && votes[SpotifyTogether._userId];
      }

      _computeVoteCount(votes) {
        return votes ? Object.keys(votes).length : 0;
      }
  
      _trackChecked(event) {
        const addVote = event.srcElement.checked;
        const track = this.$.queueRepeat.itemForElement(event.target);
        SpotifyTogether.voteTrack(track.id, addVote);
      }

    }

    window.customElements.define(MyQueue.is, MyQueue);
  </script>
</dom-module>
