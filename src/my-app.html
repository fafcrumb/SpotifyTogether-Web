
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="app-theme.html">
<link rel="import" href="my-icons.html">


<dom-module id="my-app">
  <template>
    <style>
       :host {
        display: block;
      }
      
       :host > *[hidden] {
        display: none !important;
      }

      #overlay {
        @apply --layout;
        @apply --layout-fit;
        @apply --layout-center-center;    
      }
    </style>

    <firebase-app
        id="firebase"
        auth-domain="spotify-party-da303.firebaseapp.com"
        database-url="https://spotify-party-da303.firebaseio.com/"
        api-key="AIzaSyBJxf-hJa7RQVBPYkdjt27yBcDj0b1tG8o"></firebase-app>

    <firebase-auth
        id="auth"
        user="{{user}}"
        status-known="{{statusKnown}}"></firebase-auth>

    <app-location route="{{route}}"></app-location>

    <div id="overlay" hidden$="[[!loading]]">
      <paper-spinner id="loading" active="[[loading]]"></paper-spinner>
    </div>

    <login-view 
        id="login"
        hidden$="[[user]]"></login-view>

    <main-app-view
        id="app"
        hidden$="[[!user]]"></main-app-view>

  </template>

  <script>
    class MyApp extends Polymer.Element {

      static get is() { return 'my-app'; }

      static get properties() {
        return {
          loading: {
            type: Boolean,
            value: true,
          },
          route: Object,
          user: Object,
          statusKnown: Boolean,
        };
      }

      static get observers() {
        return [
          '_authStatus(statusKnown, user)',
        ];
      }

      _authStatus(statusKnown, user) {
        if (!statusKnown) {
          this.loading = true;
          return;
        }
        if (user) {
          this._loadPage('main-app-view.html');
          if (this.route.path === '/login' ||
              this.route.path === '/')
            this.set('route.path', '/view1');
        } else {
          this._loadPage('login-view.html');
          this.set('route.path', '/login');
        }
      }

      _loadPage(pageName) {
        Polymer.importHref(
          this.resolveUrl(pageName),
          this._pageLoadedCallback.bind(this),
          null, true);
      }

      _pageLoadedCallback() {
        this.loading = false;
      }

    }

    window.customElements.define(MyApp.is, MyApp);
  </script>
</dom-module>